---
title: "Mini-Project 2"
author: "Aoi and Stella"
date: "March 9, 2018"
output: 
  html_document:
    code_folding: hide
---

```{r, include=FALSE, messages=FALSE, warning=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
library(dplyr)
library(ggplot2)
library(fiftystater)
library(gridExtra)
```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
# making the list for fifty states
fifty_states_name <-c("AK", "AL", "AR", "AZ", "CA", "CO", "CT", "DE", "FL", "GA", "HI", "IA", "ID", "IL", "IN", "KS", "KY", "LA", "MA", "MD", "ME", "MI", "MN", "MO", "MS", "MT", "NC", "ND", "NE", "NH", "NJ", "NM", "NV", "NY", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VA", "VT", "WA", "WI", "WV", "WY" )

# renaming the column name of fec_id to cand_id and filter it to just include 50 states
house_elections <- house_elections %>%
  rename(cand_id = fec_id) %>%
  filter(state %in% fifty_states_name)

#filter the data to just include 50 states
candidates <- candidates %>%
  filter(cand_state %in% fifty_states_name)

```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
# adding an indicator variable that say win = 1 and lose = 0
house_elections <- house_elections %>%
  mutate(winner = ifelse(ge_winner == "W", 1, 0)) 

# to unshow 2 unnecessity columns 
house_elections$"ifelse(ge_winner == \"W\", 1, 0)"<- NULL
house_elections$"winner <- ifelse(ge_winner == \"W\", 1, 0)"<- NULL
```


- group by party contribution map per party 
```{r, message=FALSE, warning=FALSE, echo=FALSE}
# join the candidates data and contributions data
candi_conti <- inner_join(candidates, contributions)

# compute the amount of contribution per state and party.
party_contribution <- candi_conti %>%
  group_by(cand_state, cand_party_affiliation) %>%
  summarise(contri_party = sum(transaction_amt)) 
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# changing the the observation name in the sum_data data frame
party_contribution$cand_state[party_contribution$cand_state== "AK"] <- "alaska"
party_contribution$cand_state[party_contribution$cand_state== "AL"] <- "alabama"
party_contribution$cand_state[party_contribution$cand_state== "AR"] <- "arkansas"
party_contribution$cand_state[party_contribution$cand_state== "AZ"] <- "arizona"
party_contribution$cand_state[party_contribution$cand_state== "CA"] <- "california"
party_contribution$cand_state[party_contribution$cand_state== "CO"] <- "colorado"
party_contribution$cand_state[party_contribution$cand_state== "CT"] <- "connecticut"
party_contribution$cand_state[party_contribution$cand_state== "DE"] <- "delaware"
party_contribution$cand_state[party_contribution$cand_state== "FL"] <- "florida"
party_contribution$cand_state[party_contribution$cand_state== "GA"] <- "georgia"
party_contribution$cand_state[party_contribution$cand_state== "HI"] <- "hawaii"
party_contribution$cand_state[party_contribution$cand_state== "IA"] <- "iowa"
party_contribution$cand_state[party_contribution$cand_state== "ID"] <- "idaho"
party_contribution$cand_state[party_contribution$cand_state== "IL"] <- "illinois"
party_contribution$cand_state[party_contribution$cand_state== "IN"] <- "indiana"
party_contribution$cand_state[party_contribution$cand_state== "KS"] <- "kansas"
party_contribution$cand_state[party_contribution$cand_state== "KY"] <- "kentucky"
party_contribution$cand_state[party_contribution$cand_state== "LA"] <- "louisiana"
party_contribution$cand_state[party_contribution$cand_state== "MA"] <- "massachusetts"
party_contribution$cand_state[party_contribution$cand_state== "MD"] <- "maryland"
party_contribution$cand_state[party_contribution$cand_state== "ME"] <- "maine"
party_contribution$cand_state[party_contribution$cand_state== "MI"] <- "michigan"
party_contribution$cand_state[party_contribution$cand_state== "MN"] <- "minnesota"
party_contribution$cand_state[party_contribution$cand_state== "MO"] <- "missouri"
party_contribution$cand_state[party_contribution$cand_state== "MS"] <- "mississippi"
party_contribution$cand_state[party_contribution$cand_state== "MT"] <- "montana"
party_contribution$cand_state[party_contribution$cand_state== "NC"] <- "north carolina"
party_contribution$cand_state[party_contribution$cand_state== "ND"] <- "north dakota"
party_contribution$cand_state[party_contribution$cand_state== "NE"] <- "nebraska"
party_contribution$cand_state[party_contribution$cand_state== "NH"] <- "new hampshire"
party_contribution$cand_state[party_contribution$cand_state== "NJ"] <- "new jersey"
party_contribution$cand_state[party_contribution$cand_state== "NM"] <- "new mexico"
party_contribution$cand_state[party_contribution$cand_state== "NV"] <- "nevada"
party_contribution$cand_state[party_contribution$cand_state== "NY"] <- "new york"
party_contribution$cand_state[party_contribution$cand_state== "OH"] <- "ohio"
party_contribution$cand_state[party_contribution$cand_state== "OK"] <- "oklahoma"
party_contribution$cand_state[party_contribution$cand_state== "OR"] <- "oregon"
party_contribution$cand_state[party_contribution$cand_state== "PA"] <- "pennsylvania"
party_contribution$cand_state[party_contribution$cand_state== "RI"] <- "rhode island"
party_contribution$cand_state[party_contribution$cand_state== "SC"] <- "south carolina"
party_contribution$cand_state[party_contribution$cand_state== "SD"] <- "south dakota"
party_contribution$cand_state[party_contribution$cand_state== "TN"] <- "tennessee"
party_contribution$cand_state[party_contribution$cand_state== "TX"] <- "texas"
party_contribution$cand_state[party_contribution$cand_state== "UT"] <- "utah"
party_contribution$cand_state[party_contribution$cand_state== "VA"] <- "virginia"
party_contribution$cand_state[party_contribution$cand_state== "VT"] <- "vermont"
party_contribution$cand_state[party_contribution$cand_state== "WA"] <- "washington"
party_contribution$cand_state[party_contribution$cand_state== "WI"] <- "wisconsin"
party_contribution$cand_state[party_contribution$cand_state== "WV"] <- "west virginia"
party_contribution$cand_state[party_contribution$cand_state== "WY"] <- "wyoming"
```

```{r, message=FALSE, warning=FALSE, echo=FALSE}

parties <- c("CON", "DEM", "DFL", "GRE", "IAP", "IND", "LIB", "NNE", "NPA", "OTH", "REP", "SUS", "SWP", "UNK", "WFP")


num_party <- party_contribution %>%
  group_by(cand_party_affiliation) %>%
  summarise(num = n())
  
min_contri <- party_contribution %>%
  group_by(cand_party_affiliation) %>%
  summarise(mini = min(contri_party))

max_contri <- party_contribution %>%
  group_by(cand_party_affiliation) %>%
  summarise(maxi = max(contri_party))

mid_contri <- inner_join(min_contri,max_contri) %>%
  mutate(midd = (mini + maxi)/2)

party_contribution <- inner_join(party_contribution, mid_contri)

```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
# create a map showing total contribution for each party 

# mapping "no party name" contribution
non <- party_contribution %>% filter(cand_party_affiliation == "")
non_mapping <- ggplot(non, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to No Party Name") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")

#mapping CON's contribution
con <- party_contribution %>% filter(cand_party_affiliation == "CON")
con_mapping <- ggplot(con, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Constitution") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")


#mapping DEM's contribution
dem <- party_contribution %>% filter(cand_party_affiliation == "DEM")
dem_mapping <- ggplot(dem, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Democratic") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(4000, 215000000, 430000000), labels = c("4k","215000K", "430000K"), low = "#B0E2FF", high = "#607B8B")


#mapping DFL's contribution 
dfl <- party_contribution %>% filter(cand_party_affiliation == "DFL")
dfl_mapping <- ggplot(dfl, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Democratic Farmer Labor Party") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")


#mapping GRE's contribution
gre <- party_contribution %>% filter(cand_party_affiliation == "GRE")
gre_mapping <- ggplot(gre, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Green") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(250, 4400, 8608), labels = c("0.25K", "4.4K", "8.6K"), low = "#B0E2FF", high = "#607B8B")


#mapping IAP's contribution
iap <- party_contribution %>% filter(cand_party_affiliation == "IAP")
iap_mapping <- ggplot(iap, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Independent American Party") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")


#mapping IND's contribution
ind <- party_contribution %>% filter(cand_party_affiliation == "IND")
ind_mapping <- ggplot(gre, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Independent") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(-1000, 2000000, 4175660), labels = c("-1K", "2000K", "4180K"), low = "#B0E2FF", high = "#607B8B")


#mapping LIB's contribution
lib <- party_contribution %>% filter(cand_party_affiliation == "LIB")
lib_mapping <- ggplot(lib, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Libertarian") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(800, 280000, 555314), labels = c("0.8K", "280K", "555K"), low = "#B0E2FF", high = "#607B8B")


#mapping NNE's contribution
nne <- party_contribution %>% filter(cand_party_affiliation == "NNE")
nne_mapping <- ggplot(lib, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to None") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(11725, 320000, 520000), labels = c("11K", "32K", "52K"), low = "#B0E2FF", high = "#607B8B")


#mappping NPA's contribution
npa <- party_contribution %>% filter(cand_party_affiliation == "NNE")
npa_mapping <- ggplot(npa, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to No party Affiliation") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")


#mapping OTH's contribution 
oth <- party_contribution %>% filter(cand_party_affiliation == "OTH")
oth_mapping <- ggplot(oth, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Other") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(74, 58000, 116637), labels = c("0.074K", "58K", "116K"), low = "#B0E2FF", high = "#607B8B")


#mapping REP's contribution 
rep <- party_contribution %>% filter(cand_party_affiliation == "REP")
rep_mapping <- ggplot(rep, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Republican") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(1050, 99700000, 199441933), labels = c("1K", "99700K", "19944K"), low = "#B0E2FF", high = "#607B8B")


#mapping SUS's contribution
sus <- party_contribution %>% filter(cand_party_affiliation == "SUS")
sus_mapping <- ggplot(sus, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Socialist Party") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(250, 270, 299), labels = c("0.25K", "0.27K", "0.3K"), low = "#B0E2FF", high = "#607B8B")


#mapping SWP's contribution 
swp <- party_contribution %>% filter(cand_party_affiliation == "SWP")
swp_mapping <- ggplot(swp, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Socialist Workers Party") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")


#mapping UNK's contribution
unk <- party_contribution %>% filter(cand_party_affiliation == "UNK")
unk_mapping <- ggplot(unk, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to UNK") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (breaks = c(100, 140000, 280000), labels = c("0.1K", "140K", "280K"), low = "#B0E2FF", high = "#607B8B")


#mapping WFP's contribution 
wfp <- party_contribution %>% filter(cand_party_affiliation == "WFP")
wfp_mapping <- ggplot(wfp, aes(map_id = cand_state)) +
  # map points to the fifty_states shape data
  geom_map(aes(fill = contri_party), map = fifty_states) +
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) +
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "", title = "Contribution to Working Families Party") +
  theme(legend.position = "bottom",
        panel.background = element_blank(), plot.title = element_text(face = "bold")) + 
  labs(fill = "Amount of Contribution") +
  scale_fill_continuous (low = "#B0E2FF", high = "#607B8B")

```

```{r, message=FALSE, warning=FALSE, echo=FALSE}
#mapping out 
# grid.arrange( non_mapping, con_mapping, dem_mapping, dfl_mapping, gre_mapping, iap_mapping, ind_mapping, lib_mapping, nne_mapping, npa_mapping, oth_mapping, rep_mapping, sus_mapping, swp_mapping, unk_mapping, wfp_mapping, nrow = 9)

non_mapping
con_mapping
dem_mapping
dfl_mapping
gre_mapping
iap_mapping
ind_mapping
lib_mapping
nne_mapping
npa_mapping
oth_mapping
rep_mapping
sus_mapping
swp_mapping
unk_mapping
wfp_mapping
```



- see choose one party and see if they have more winner or not 
```{r, message=FALSE, warning=FALSE, echo=FALSE, fig.width = 10, fig.height= 40}

target <- c("R", "D")

one_rep_dem <- house_elections %>%
  filter(party %in% target) 

#see parties from republican and democrats the rate of elected per state
rate_rep_dem <- house_elections %>%
  filter(party %in% target) %>%
  group_by(state, party) %>%
  summarise(rate_winner = sum(winner)/n() * 100) 

#function
R_n_D <- function(name_arg) {
  
RD_party <- rate_rep_dem %>%
   filter(state == name_arg)
  
ggplot(RD_party, aes(x = party, y = rate_winner)) + 
  geom_bar(stat = "identity") + 
  labs( x = "Party", y = "Ratio of Winner", title = name_arg) + 
  theme(plot.title = element_text(face = "bold")) 
  
}

RD_plots <- lapply(fifty_states_name, R_n_D)

# RD_plots

do.call("grid.arrange", c(RD_plots, ncol=3))


```

***
[^1]: https://github.com/stellali0311/sds192-mp2.git 









