---
title: "Mini-Project 2"
author: "Aoi and Stella"
date: "March 9, 2018"
output: html_document
---


## Loading the data

This project is so interesting and relevant to my life!

```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
library(dplyr)
library(ggplot2)

house_elections <- house_elections %>%
  rename(cand_id = fec_id)

```

The data set is from 2011-2012.
canditates = Candidate Master File
committees = Committee Master File
contributions = Contributions to Candidates (and other expenditures) from committees

idea

- is there a relaitonship between amount of contribution and being elected?

- which contributor is contributing the most? and is there a contributor which tends to contribute to the winner? and the relation with the transaction type ==> use candidate ids to link to the candidates  

- How different are men and women candidates in general? the amount of contribution, the amount of voting, and the rate of being elected 


```{r}
# all_contributions <- contributions %>% 
#   group_by(cand_id) %>%
#   summarize(contribuion_sum = sum(transaction_amt)) 
#   
# candidates_n_contributions <- inner_join(candidates, contributions)
# 
# house_elections <- house_elections %>%
#   rename(cand_id = fec_id)
# 
# candidates_n_contributions %>% left_join(house_elections, by = "cand_id")
```

```{r}
house_elections <- house_elections %>%
  mutate(winner = ifelse(ge_winner == "W", 1, 0)) 
house_elections$"ifelse(ge_winner == \"W\", 1, 0)"<- NULL
house_elections$"winner <- ifelse(ge_winner == \"W\", 1, 0)"<- NULL
```


<<<<<<< HEAD
=======
```{r}
all_contributions <- contributions %>% 
  group_by(cand_id) %>%
  summarize(contribution_sum = sum(transaction_amt)) 

condi_contri <- house_elections %>% left_join(all_contributions, by = "cand_id")
```
>>>>>>> 1aa539b7388934b75252cd1e3589d01fddc7d6e5

```{r}
mod1 <- lm(general_votes ~ contribution_sum, condi_contri)

summary(mod1)
ggplot(condi_contri, aes(x = contribution_sum, y = general_votes)) + geom_point()
```

- ask the general votes and primary votes 


The contributors ranking from the most contributor to the least 
```{r}
most_contri <- contributions %>%
  group_by(cmte_id) %>%
  summarise(sum_trans = sum(transaction_amt)) %>%
  arrange(desc(sum_trans))

most_can <- contributions %>%
  group_by(cmte_id) %>%
  summarise(sum_can = sum(n_distinct(cand_id))) %>%
  arrange(desc(sum_can))

# the data set which describes the most contribution and how many candidates the contributors are supporting 
money_n_ppl <- inner_join (most_contri, most_can) 

# Looking at the contributor (top 10) and the candidates elecition results
top_10_contributors <- money_n_ppl %>%
  head(10)

top_10 <- top_10_contributors$cmte_id



top_10_candi <- contributions %>%
  filter(cmte_id %in% top_10)


data_sum <- contributions %>% inner_join (house_elections, by = "cand_id")

```

C00487363 => 20/22 win
C90011719 => 38/61 win
C00075820 => 


```{r}
# which contributors supported the most elected candidates 
winner_num <- data_sum %>%
  filter(winner == "1") %>%
  group_by(cmte_id) %>%
  summarise(sum_win = sum(n_distinct(cand_id)))
  

# %>% 
#   group_by(cmte_id) %>%
#   summarise(n_winner = sum(n_distinct(winner)))

# the sum of candidates who the contributor is suporting 
all_sum <- data_sum %>%
  group_by(cmte_id) %>%
  summarise(sum_can = sum(n_distinct(cand_id)))

# the sum of candidates who has been elected
rate_elected <- inner_join(winner_num, all_sum) %>%
  mutate(rate = sum_win/sum_can) %>%
  arrange(desc(sum_win)) %>%
  arrange(desc(rate)) 
  

# a data set that contains the rate of winning the election and the amount of contribution 
sum_contri <- inner_join(rate_elected, most_contri)
# => there's no relationship between contribution and the rate of the person who will get elected 
```
we could map like contributor to the candidate on the map (if it looks interesting)
```{r}
sum_contri %>% filter(sum_win > 20)
```


Mapping 
```{r}
library(fiftystater)

data("fifty_states") # this line is optional due to lazy data loading

crimes <- data.frame(state = tolower(rownames(USArrests)), USArrests)

# map_id creates the aesthetic mapping to the state name column in your data
p <- ggplot(crimes, aes(map_id = state)) + 
  # map points to the fifty_states shape data
  geom_map(aes(fill = Assault), map = fifty_states) + 
  expand_limits(x = fifty_states$long, y = fifty_states$lat) +
  coord_map() +
  scale_x_continuous(breaks = NULL) + 
  scale_y_continuous(breaks = NULL) +
  labs(x = "", y = "") +
  theme(legend.position = "bottom", 
        panel.background = element_blank())

p
# add border boxes to AK/HI
p + fifty_states_inset_boxes() 

```
